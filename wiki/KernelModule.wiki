#summary How to use the kernel module
#labels Featured,Phase-Design

= Introduction =

The module has an interface in /proc/overclock/ that allows enabling and disabling of overclock in runtime without rebooting. It works by changing several parameters directly in kernel memory to fool both CPUfreq and its lowlevel OMAP driver.

The MPU (Microprocessor Unit) clock has 5 discrete pairs of possible rate frequencies and respective voltages, of which only 4 are passed down to CPUfreq as you can see with a tool such as SetCPU.  The default frequencies are 125, 250, 500 and 550 MHz (and a hidden 600).  By using this module, you are changing the highest pair in the tables of both cpufreq and MPU frequencies, so it becomes 125, 250, 500 and, say, 800.  It's quite stable up to 1200; beyond that it quickly becomes unusable, specially over 1300, with lockups or spontaneous reboots.

For this to work, the module must know two memory addresses that are specific to each kernel. This version was prepared for Motorola Milestone's official Android 2.1 for Central Europe, build number SHOLS_U2_02.31.0. Fortunately Motorola appears to have used the same kernel in most of the 2.1 firmwares. Users with Russian and Thai firmwares reported failures but after flashing the Central Europe kernel (in the Russian case) and Telus kernel (for Thai) it worked. You can see the different firmware/kernels available at [http://and-developers.com/motorola_milestone:sbf and-developers] (2.1 table), just make sure the WCDMA values of the new kernel match those of your country. To extract the kernel from a firmware use the [http://and-developers.com/motorola_milestone:sbf SBF Depacker] (thanks Skrilax). See the [Disassembly] page for detailed instructions on porting the module to different kernels or even other phones. Testers welcome!

= Usage =

The module is created at /data/data/pt.com.darksun.milestoneoverclock/files/overclock.ko when it is first loaded through the app. Afterwards you can load and use it directly:

{{{
insmod overclock.ko
echo 62 > /proc/overclock/max_vsel
echo 800000 > /proc/overclock/max_rate
}}}
	
You should set max_vsel before max_rate if the new rate is going to be higher than the current one, because higher frequencies often require more voltage than supplied by default.  Likewise, lower the max_rate first before max_vsel if you want to reduce both frequency and voltage:

{{{
echo 550000 > /proc/overclock/max_rate
echo 56 > /proc/overclock/max_vsel
}}}

To set a specified frequency and voltage at load time:
{{{
insmod overclock.ko max_rate=800000 max_vsel=62
}}}

Remember that you are merely changing the maximum possible value that CPUfreq can choose to use.  The current speed may well be lower than the one specified if the phone is idle. I recommend the use of [http://www.pokedev.com/setcpu/ SetCPU] to effectively change the current frequency through CPUfreq policies.

You may also supply the addresses of the two needed in-memory kernel structures which may change with each firmware build and will probably have to be supplied either at load time with the freq_table_addr and mpu_opps_ptr_addr parameters or with their respective /proc entries.  Finding out the values will require live disassembly of kernel code.  See the [Disassembly] page for more information.

Frequencies/Voltages that appear to work well together (thanks to kabaldan for corrections):

|| *Frequency (KHz)* || * vsel * || *Voltage (V)* ||
|| 550000 || 56 || 1.3 ||
|| 600000 || 62 || 1.375 ||
|| 800000 || 68 || 1.45 ||
|| 1000000 || 74 || 1.525 ||
|| 1200000 || 80 || 1.6 ||

The maximum vsel I could use was 127. The safe upper limit in the processor specs is 1.8V which translates to vsel 96 (according to [http://wiki.droidmod.org/doku.php?id=vsel_calc wikidroid]). Frequencies above 1250000 usually reboot spontaneously.